# –¢–µ—Ö–Ω—ñ—á–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è: WebSocket –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞–±—ñ–≤

## –ú–µ—Ç–∞
–î–æ–¥–∞—Ç–∏ WebSocket –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫—ñ –∑–º—É—Å—è—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞–± –∑ —Ç—É—Ä–Ω—ñ—Ä–æ–º –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥—É –∞–±–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ñ —Ç—É—Ä–Ω—ñ—Ä—É.

## –í–∏–º–æ–≥–∏

### 1. –ü–æ–¥—ñ—è: `next_round_created`
**–ö–æ–ª–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è:**
- –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥—É —á–µ—Ä–µ–∑ `POST /tournaments/{id}/next-round`
- –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç—É —Ñ—ñ–Ω–∞–ª—ñ–≤ —á–µ—Ä–µ–∑ `POST /tournaments/{id}/start-finals`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:**
```json
{
  "type": "next_round_created",
  "tournament_id": 29,
  "tournament_name": "Summer Cup",
  "round_number": 3,
  "is_final": false,
  "round_name": "Round 3",
  "force_reload": true,              // –ù–û–í–ï –ü–û–õ–ï: –∑–º—É—Å–∏—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞–±
  "priority": "high",
  "requires_action": true,
  "sound": "round_start",
  "title": "‚öîÔ∏è Round 3 Created!",
  "message": "Round 3 of tournament 'Summer Cup' has been created. The page will reload to show the new round.",
  "action_text": "Add lobby maker as friend",
  "icon": "‚öîÔ∏è",
  "timestamp": "2025-11-28T10:30:00Z"
}
```

**–î–ª—è —Ñ—ñ–Ω–∞–ª—ñ–≤:**
```json
{
  "type": "next_round_created",
  "tournament_id": 29,
  "tournament_name": "Summer Cup",
  "round_number": 6,
  "is_final": true,
  "round_name": "Final 1",
  "force_reload": true,              // –ù–û–í–ï –ü–û–õ–ï
  "priority": "high",
  "requires_action": true,
  "sound": "round_start",
  "title": "üèÜ Final 1 Created!",
  "message": "Final 1 of tournament 'Summer Cup' has been created. The page will reload to show the new round.",
  "action_text": "Add lobby maker as friend",
  "icon": "üèÜ",
  "timestamp": "2025-11-28T10:30:00Z"
}
```

### 2. –ü–æ–¥—ñ—è: `tournament_finished` (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è)
**–ö–æ–ª–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è:**
- –ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç—É—Ä–Ω—ñ—Ä—É —á–µ—Ä–µ–∑ `POST /tournaments/{id}/finish`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–æ–Ω–æ–≤–ª–µ–Ω–∞):**
```json
{
  "type": "tournament_finished",
  "tournament_id": 29,
  "tournament_name": "Summer Cup",
  "force_reload": true,              // –ù–û–í–ï –ü–û–õ–ï: –∑–º—É—Å–∏—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞–±
  "priority": "high",                // –ó–º—ñ–Ω–µ–Ω–æ –∑ "medium" –Ω–∞ "high"
  "requires_action": false,
  "sound": "tournament_finished",
  "title": "‚úÖ Tournament Finished",
  "message": "Tournament 'Summer Cup' has finished. The page will reload to show the final results.",
  "icon": "‚úÖ",
  "timestamp": "2025-11-28T10:30:00Z"
}
```

## –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
1. **next_round_created:**
   - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –≤—Å—ñ–º —É—á–∞—Å–Ω–∏–∫–∞–º —Ç—É—Ä–Ω—ñ—Ä—É (—á–µ—Ä–µ–∑ `broadcast_to_tournament`)
   - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–∞—É–Ω–¥—É –≤ –ë–î
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ (–Ω–µ –±–ª–æ–∫—É—î API –∑–∞–ø–∏—Ç)

2. **tournament_finished:**
   - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –≤—Å—ñ–º —É—á–∞—Å–Ω–∏–∫–∞–º —Ç—É—Ä–Ω—ñ—Ä—É (—á–µ—Ä–µ–∑ `broadcast_to_tournament`)
   - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç—É—Ä–Ω—ñ—Ä—É –≤ –ë–î
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ (–Ω–µ –±–ª–æ–∫—É—î API –∑–∞–ø–∏—Ç)

### –ü–æ–ª–µ `force_reload`
- **–¢–∏–ø:** `boolean`
- **–ó–Ω–∞—á–µ–Ω–Ω—è:** `true` - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–≤–∏–Ω–µ–Ω –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞–±/—Å—Ç–æ—Ä—ñ–Ω–∫—É
- **–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –Ø–≤–Ω–æ –≤–∫–∞–∑—É—î —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∞–±–æ —Ç–∞–±—É

### –û–±—Ä–æ–±–∫–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ñ
–ü—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ `force_reload: true`:
1. –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
2. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞–±/—Å—Ç–æ—Ä—ñ–Ω–∫—É –∑ —Ç—É—Ä–Ω—ñ—Ä–æ–º
3. –ê–±–æ –∑—Ä–æ–±–∏—Ç–∏ `GET /tournaments/{id}` –∑–∞–ø–∏—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö

## –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### –§–∞–π–ª–∏ –¥–ª—è –∑–º—ñ–Ω–∏:
1. `services/notification_service.py` - –¥–æ–¥–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é `notify_next_round_created()` —Ç–∞ –æ–Ω–æ–≤–∏—Ç–∏ `notify_tournament_finished()`
2. `api/routers/tournaments.py` - –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –Ω–æ–≤—É —Ñ—É–Ω–∫—Ü—ñ—é –≤ `create_next_round_endpoint()` —Ç–∞ `start_finals_endpoint()`
3. `docs/WEBSOCKET_API.md` - –æ–Ω–æ–≤–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é –∑ –Ω–æ–≤–∏–º–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏

### –í–∞–∂–ª–∏–≤–æ:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É –≤—ñ–¥–ø—Ä–∞–≤–∫—É (–Ω–µ `asyncio.create_task()` –∑ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É)
- –í—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –ë–î
- –í–∫–ª—é—á–∞—Ç–∏ –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ñ

